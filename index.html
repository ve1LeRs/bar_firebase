<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bar ‚Äî –ö–æ–∫—Ç–µ–π–ª–∏</title>
  <link rel="stylesheet" href="style.css">

  <!-- ‚ö†Ô∏è –í–ê–ñ–ù–û: –∏–º–µ–Ω–Ω–æ —ç—Ç–∏ —Å—Å—ã–ª–∫–∏ ‚Äî –ë–ï–ó –ü–†–û–ë–ï–õ–û–í, –¢–û–õ–¨–ö–û COMPAT -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>Bar</h1>
      <p>–ò–∑—ã—Å–∫–∞–Ω–Ω—ã–µ –∫–æ–∫—Ç–µ–π–ª–∏, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Å –ª—é–±–æ–≤—å—é</p>
      <div class="auth-buttons">
        <button id="loginBtn">–í–æ–π—Ç–∏</button>
        <button id="registerBtn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        <button id="logoutBtn" style="display:none">–í—ã–π—Ç–∏</button>
        <span id="userEmail" style="margin-left: 20px; font-weight: 500;"></span>
      </div>
    </header>

    <div id="authModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h3 id="modalTitle">–í—Ö–æ–¥</h3>
        <form id="authForm">
          <input type="email" id="email" placeholder="Email" required>
          <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" required>
          <button type="submit">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
          <p id="toggleForm">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" id="switchToRegister">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></p>
        </form>
      </div>
    </div>

    <main class="cocktails-grid">
      <div class="cocktail-card">
        <img src="https://images.unsplash.com/photo-1582716961908-67476f398b5b?w=600&h=800&fit=crop&crop=entropy" alt="–ú–æ—Ö–∏—Ç–æ">
        <div class="card-content">
          <h2>–ú–æ—Ö–∏—Ç–æ</h2>
          <p class="ingredients">–†–æ–º, –º—è—Ç–∞, –ª–∞–π–º, —Å–∞—Ö–∞—Ä, —Å–æ–¥–æ–≤–∞—è</p>
          <button class="order-btn" data-name="–ú–æ—Ö–∏—Ç–æ" data-price="450‚ÇΩ">–ó–∞–∫–∞–∑–∞—Ç—å</button>
        </div>
      </div>

      <div class="cocktail-card">
        <img src="https://images.unsplash.com/photo-1578608976700-7a27a5b5d2a8?w=600&h=800&fit=crop&crop=entropy" alt="–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞">
        <div class="card-content">
          <h2>–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞</h2>
          <p class="ingredients">–¢–µ–∫–∏–ª–∞, –ª–∏–∫—ë—Ä –¢—Ä–∏–ø–ª –°–µ–∫, —Å–æ–∫ –ª–∞–π–º–∞</p>
          <button class="order-btn" data-name="–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞" data-price="500‚ÇΩ">–ó–∞–∫–∞–∑–∞—Ç—å</button>
        </div>
      </div>

      <div class="cocktail-card">
        <img src="https://images.unsplash.com/photo-1600275549035-53693d556705?w=600&h=800&fit=crop&crop=entropy" alt="–û–ª–¥ –§—ç—à–Ω">
        <div class="card-content">
          <h2>–û–ª–¥ –§—ç—à–Ω</h2>
          <p class="ingredients">–ë—É—Ä–±–æ–Ω, —Å–∞—Ö–∞—Ä, –∞–Ω–≥–æ—Å—Ç—É—Ä–∞, –∞–ø–µ–ª—å—Å–∏–Ω</p>
          <button class="order-btn" data-name="–û–ª–¥ –§—ç—à–Ω" data-price="550‚ÇΩ">–ó–∞–∫–∞–∑–∞—Ç—å</button>
        </div>
      </div>
    </main>
  </div>

  <div id="orderModal" class="modal">
    <div class="modal-content">
      <span class="close" id="closeOrderModal">&times;</span>
      <h3>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –∑–∞–∫–∞–∑</h3>
      <p id="orderSummary"></p>
      <button id="confirmOrder">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </div>
  </div>

  <script>
    // üî• –¢–í–û–ò –†–ï–ê–õ–¨–ù–´–ï –ö–õ–Æ–ß–ò FIREBASE ‚Äî –£–ë–ï–î–ò–°–¨, –ß–¢–û –ù–ï–¢ –õ–ò–®–ù–ò–• –°–ò–ú–í–û–õ–û–í
    const firebaseConfig = {
      apiKey: "AIzaSyB4bD8UAu0Aj5IRK5H-uZg6kxNAIbkZc9k",
      authDomain: "bar-menu-6145c.firebaseapp.com",
      projectId: "bar-menu-6145c",
      storageBucket: "bar-menu-6145c.firebasestorage.app",
      messagingSenderId: "493608422842",
      appId: "1:493608422842:web:3b4b6bd8a4cb681c436183"
    };

    // ü§ñ Telegram ‚Äî –ø–æ–∫–∞ –æ—Å—Ç–∞–≤—å XXX, —Å–Ω–∞—á–∞–ª–∞ –¥–æ–±—å—ë–º—Å—è, —á—Ç–æ–±—ã Firebase –∑–∞—Ä–∞–±–æ—Ç–∞–ª
    const TELEGRAM_BOT_TOKEN = "8326139522:AAG2fwHYd1vRPx0cUXt4ATaFYTNxmzInWJo";
    const TELEGRAM_CHAT_ID = "1743362083";

    // ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase ‚Äî –µ—Å–ª–∏ firebase –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω ‚Äî –æ—à–∏–±–∫–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å
    if (typeof firebase === 'undefined') {
      alert('‚ùå Firebase –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–∫—Ä–∏–ø—Ç—ã –≤ <head>');
    } else {
      const app = firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const db = firebase.firestore();

      // ‚úÖ –ï—Å–ª–∏ –¥–æ—à–ª–∏ —Å—é–¥–∞ ‚Äî Firebase —Ä–∞–±–æ—Ç–∞–µ—Ç
      console.log('‚úÖ Firebase —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');

      // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ ...
      const loginBtn = document.getElementById('loginBtn');
      const registerBtn = document.getElementById('registerBtn');
      const logoutBtn = document.getElementById('logoutBtn');
      const userEmail = document.getElementById('userEmail');
      const authModal = document.getElementById('authModal');
      const modalTitle = document.getElementById('modalTitle');
      const authForm = document.getElementById('authForm');
      const toggleForm = document.getElementById('toggleForm');
      const switchToRegister = document.getElementById('switchToRegister');
      const closeBtns = document.querySelectorAll('.close');
      const orderButtons = document.querySelectorAll('.order-btn');
      const orderModal = document.getElementById('orderModal');
      const orderSummary = document.getElementById('orderSummary');
      const confirmOrderBtn = document.getElementById('confirmOrder');

      let currentOrder = null;

      auth.onAuthStateChanged(user => {
        if (user) {
          loginBtn.style.display = 'none';
          registerBtn.style.display = 'none';
          logoutBtn.style.display = 'inline-block';
          userEmail.textContent = user.email;
        } else {
          loginBtn.style.display = 'inline-block';
          registerBtn.style.display = 'inline-block';
          logoutBtn.style.display = 'none';
          userEmail.textContent = '';
        }
      });

      loginBtn?.addEventListener('click', () => {
        modalTitle.textContent = '–í—Ö–æ–¥';
        toggleForm.innerHTML = '–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" id="switchToRegister">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>';
        authModal.style.display = 'block';
      });

      authModal?.addEventListener('click', (e) => {
        if (e.target.id === 'switchToRegister') {
          modalTitle.textContent = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è';
          toggleForm.innerHTML = '–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="#" id="switchToLogin">–í–æ–π—Ç–∏</a>';
          e.preventDefault();
        } else if (e.target.id === 'switchToLogin') {
          modalTitle.textContent = '–í—Ö–æ–¥';
          toggleForm.innerHTML = '–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" id="switchToRegister">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>';
          e.preventDefault();
        }
      });

      closeBtns.forEach(btn => {
        btn?.addEventListener('click', () => {
          authModal.style.display = 'none';
          orderModal.style.display = 'none';
        });
      });

      authForm?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;

        try {
          if (modalTitle.textContent === '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è') {
            await auth.createUserWithEmailAndPassword(email, password);
            alert('‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!');
          } else {
            await auth.signInWithEmailAndPassword(email, password);
          }
          authModal.style.display = 'none';
        } catch (error) {
          alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
        }
      });

      logoutBtn?.addEventListener('click', async () => {
        await auth.signOut();
        alert('–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞');
      });

      orderButtons.forEach(btn => {
        btn?.addEventListener('click', () => {
          const user = auth.currentUser;
          if (!user) {
            alert('üîí –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –¥–ª—è –∑–∞–∫–∞–∑–∞.');
            return;
          }
          const name = btn.getAttribute('data-name');
          const price = btn.getAttribute('data-price');
          currentOrder = { 
            name, 
            price, 
            user: user.email, 
            timestamp: new Date().toLocaleString('ru-RU') 
          };
          orderSummary.innerHTML = `
            <strong>üç∏ –ö–æ–∫—Ç–µ–π–ª—å:</strong> ${name}<br>
            <strong>üí∞ –¶–µ–Ω–∞:</strong> ${price}<br>
            <strong>üì¨ –í–∞—à email:</strong> ${user.email}
          `;
          orderModal.style.display = 'block';
        });
      });

      confirmOrderBtn?.addEventListener('click', async () => {
        if (!currentOrder) return;

        try {
          await db.collection('orders').add(currentOrder);

          const message = `
üÜï *–ù–æ–≤—ã–π –∑–∞–∫–∞–∑!*
üç∏ *–ö–æ–∫—Ç–µ–π–ª—å:* ${currentOrder.name}
üí∞ *–¶–µ–Ω–∞:* ${currentOrder.price}
üì¨ *–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:* ${currentOrder.user}
üïí *–í—Ä–µ–º—è:* ${currentOrder.timestamp}
          `.trim();

          const telegramUrl = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
          await fetch(telegramUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              chat_id: TELEGRAM_CHAT_ID,
              text: message,
              parse_mode: 'Markdown'
            })
          });

          alert('‚úÖ –ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –û–∂–∏–¥–∞–π—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.');
          orderModal.style.display = 'none';
          currentOrder = null;
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞:", error);
          alert('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å.');
        }
      });

      window.addEventListener('click', (e) => {
        if (e.target === authModal) authModal.style.display = 'none';
        if (e.target === orderModal) orderModal.style.display = 'none';
      });
    }
  </script>
</body>
</html>